<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Echoe</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Echoe</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/lib/echoe/extensions_rb.html">
                lib/echoe/extensions.rb
                </a>
        <br />
                <a href="../files/lib/echoe_rb.html">
                lib/echoe.rb
                </a>
        <br />
                <a href="../files/lib/echoe/extensions_rb.html">
                lib/echoe/extensions.rb
                </a>
        <br />
                <a href="../files/lib/echoe_rb.html">
                lib/echoe.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
<a href="Echoe.html">Echoe</a> includes some optional accessors for more
advanced gem configuration.
</p>
<p>
For example, a simple <tt>Rakefile</tt> might look like this:
</p>
<pre>
  require 'echoe'

  Echoe.new(&quot;uncapitalizer&quot;) do |p|
    p.author = &quot;Evan Weaver&quot;
    p.summary = &quot;A library that uncapitalizes strings.&quot;
    p.url = &quot;http://www.uncapitalizer.com&quot;
    p.docs_host = &quot;uncapitalizer.com:~/www/files/doc/&quot;
    p.runtime_dependencies = [&quot;string_tools &gt;=1.4.0&quot;]
  end
</pre>
<p>
See below for the full list.
</p>
<h2>Signing gems</h2>
<p>
<a href="Echoe.html">Echoe</a> supports signing gems. First, create
yourself a public and private key:
</p>
<pre>
  gem cert --build you@yourmail.com
</pre>
<p>
Move them somewhere secret, and add the following environment variables in
your <tt>.bash_profile</tt> or similar:
</p>
<pre>
  export GEM_PRIVATE_KEY='/secret/path/to/gem-private_key.pem'
  export GEM_CERTIFICATE_CHAIN='/secret/path/to/gem-public_cert.pem'
</pre>
<p>
Make sure your environment is up-to-date:
</p>
<pre>
  source ~/.bash_profile
</pre>
<p>
Upload your <tt>public_cert.pem</tt> file to your website or Rubyforge
project, and tell your users to add that certificate to their system via:
</p>
<pre>
  gem cert --add /path/to/public_cert.pem
</pre>
<p>
Finally, package and release your project as normal. Now users can install
your gem via:
</p>
<pre>
  sudo gem install gemname -P HighSecurity
</pre>
<p>
Note that you can also set the key and certificate locations in the
Rakefile itself. Finally, you can add <tt>p.require_signed = true</tt> to
your <tt>Rakefile</tt> so that you don&#8216;t accidentally release an
unsigned gem if your key is missing.
</p>
<h2>Metadependencies</h2>
<p>
<a href="Echoe.html">Echoe</a> does not force packages to depend on <a
href="Echoe.html">Echoe</a> itself. Instead, it generates a
<tt>gemspec</tt> from your <tt>Rakefile</tt> and includes that. Downstream
repackagers can use the <tt>gemspec</tt> as-is to build <a
href="Echoe.html#M000175">new</a> versions of your gem even without <a
href="Echoe.html">Echoe</a>.
</p>
<p>
However, <a href="Echoe.html">Echoe</a> is added to the
<tt>development_dependencies</tt> array so that users can automatically
install it via <tt>gem install &#8212;development</tt> if they prefer. You
can override this behavior by setting <tt>p.development_dependencies =
[]</tt>.
</p>
<h2>Cross-packaging</h2>
<p>
<a href="Echoe.html">Echoe</a> supports platform <a
href="Rake.html">Rake</a> targets to allow you to cross-package your gems.
Just write the spec assuming <tt>RUBY_PLATFORM</tt> will be what you need
it to be for each architecture, and then invoke <a
href="Rake.html">Rake</a> with the platform name when you&#8216;re
cross-packaging.
</p>
<p>
For example, on JRuby, <tt>rake package</tt> will build a generic
<tt>-ruby</tt> type gem. But if you want to include a Java-specific
extension, you can do one of two things. You can package from within JRuby
by checking if <tt>RUBY_PLATFORM =~ /java/</tt> and setting <tt>p.platform
= jruby</tt>, or you can run <tt>rake java package</tt>, which will set
<tt>RUBY_PLATFORM</tt> and <tt>p.platform</tt> for you.
</p>
<p>
This way you can run <tt>rake java package</tt>, <tt>rake aix install</tt>,
or whatever task you need and <a href="Echoe.html">Echoe</a> will behave
just like you&#8216;re packaging from within the target platform.
</p>
<h2>Test environment setup and teardown</h2>
<p>
For some applications, you may need to setup and teardown environment state
for the entire test suite. This is especially common for integration tests
that may need to spawn an external daemon. To support this, you can add a
file <tt>tests/setup.rb</tt> and it will be silently executed before the
entire suite runs. Add a similar file <tt>tests/teardown.rb</tt> in your
app to be executed at the end of the entire run.
</p>
<p>
Note; these files will only get executed if you run the tests via
<tt>rake</tt>. Also, you can set the environment variable
<tt>VERBOSE=1</tt> to not hide the setup/teardown output.
</p>
<h2>Accessor options</h2>
<p>
Descriptive options:
</p>
<ul>
<li><tt>author</tt> - Your name.

</li>
<li><tt>email</tt> - Your email address.

</li>
<li><tt>description</tt> - A more detailed description of the library.

</li>
<li><tt>summary</tt> - A shorter description of the library.

</li>
<li><tt>url</tt> - A url for the library.

</li>
<li><tt>install_message</tt> - A message to display after the gem is installed.

</li>
</ul>
<p>
Versioning options:
</p>
<ul>
<li><tt>version</tt> - A string for the version number. Parsed from CHANGELOG
otherwise.

</li>
<li><tt>changes</tt> - A string describing the most recent changes. Parsed from
CHANGELOG otherwise.

</li>
</ul>
<p>
Common packaging options:
</p>
<ul>
<li><tt>runtime_dependencies</tt> - An array of runtime dependencies for this
gem. For example, <tt>[&#8216;mongrel&#8217;, &#8216;activesupport &gt;=
2.0.2&#8217;]</tt>.

</li>
<li><tt>development_dependencies</tt> - An array of development dependencies
for this gem. For example, <tt>[&#8216;rake &gt;=0.7.1&#8217;]</tt>.

</li>
<li><tt>extension_pattern</tt> - A filename array, glob array, or regex for
extension files that need to be run at install time. Defaults to
<tt>&quot;ext/**/extconf.rb&quot;</tt>.

</li>
</ul>
<p>
Testing options:
</p>
<ul>
<li><tt>clean_pattern</tt> - A filename array, glob array, or regex for files
that should be removed when <tt>rake clean</tt> is run.

</li>
<li><tt>test_pattern</tt> - A filename array, glob array, or regex for test
runners. Overridden by <tt>&quot;test/test_all.rb&quot;</tt>, if it exists.

</li>
<li><tt>rcov_options</tt> - Any extra flags to pass to RCov when coverage
reports are run.

</li>
</ul>
<p>
Uncommon packaging options:
</p>
<ul>
<li><tt>platform</tt> - What platform this gem is for.

</li>
<li><tt>manifest_name</tt> - The name of the manifest file. Defaults to
<tt>Manifest</tt>.

</li>
<li><tt>need_gem</tt> - Whether to generate a gem package. Defaults to
<tt>true</tt>.

</li>
<li><tt>need_tar_gz</tt> - Whether to generate a <tt>.tar.gz</tt> package.
Defaults to <tt>true</tt>.

</li>
<li><tt>need_tgz</tt> - Whether to generate a <tt>.tgz</tt> package. Defaults
to <tt>false</tt>.

</li>
<li><tt>need_zip</tt> - Whether to generate a <tt>.zip</tt> package. Defaults
to <tt>false</tt>.

</li>
<li><tt>include_rakefile</tt> - Include the Rakefile directly within the
package. Defaults to <tt>true</tt>.

</li>
<li><tt>include_gemspec</tt> - Include the generated gemspec file within the
package. Defaults to <tt>true</tt>.

</li>
<li><tt>ruby_version</tt> - Version string for which Ruby to require (for
example, <tt>&#8217;&gt;= 1.8.4&#8216;</tt>.

</li>
<li><tt>eval</tt> - Accepts a proc to be evaluated in the context of the <a
href="Gem/Specification.html">Gem::Specification</a> object. This allows
you to set more unusual gemspec options.

</li>
<li><tt>ignore_pattern</tt> - A filename array, glob array, or regex for
pathnames that should be ignored when building the manifest.

</li>
<li><tt>executable_pattern</tt> - A filename array, glob array, or regex for
files that should be installed as wrapped executables.

</li>
</ul>
<p>
Security options:
</p>
<ul>
<li><tt>private_key</tt> - The path to your gem private key. Defaults to
ENV[&#8216;GEM_PRIVATE_KEY&#8217;], if available. This accessor is not
published in the resulting gemspec.

</li>
<li><tt>certificate_chain</tt> - An array representing your certificate
authorization chain. If no one else has signed your certificate, just set
it to your own cert. Defaults to ENV[&#8216;GEM_CERTIFICATE_CHAIN&#8217;],
if available. This accessor is not published in the resulting gemspec.

</li>
<li><tt>require_signed</tt> - Force <a href="Echoe.html">Echoe</a> to refuse to
package your gem if it&#8216;s not properly signed. Default false.

</li>
</ul>
<p>
Publishing options:
</p>
<ul>
<li><tt>project</tt> - The name of the Rubyforge project to upload to. Defaults
to the name of the gem.

</li>
<li><tt>docs_host</tt> - A host and filesystem path to publish the
documentation to. Defaults to the Rubyforge project.

</li>
</ul>
<p>
Documentation options:
</p>
<ul>
<li><tt>rdoc_pattern</tt> - A filename array, glob array, or regex for
filenames that should be passed to RDoc.

</li>
<li><tt>rdoc_template</tt> - A path to an RDoc template. Defaults to the
generic template.

</li>
</ul>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000176">apply_pattern</a>&nbsp;&nbsp;
      <a href="#M000180">apply_pattern</a>&nbsp;&nbsp;
      <a href="#M000181">define_tasks</a>&nbsp;&nbsp;
      <a href="#M000177">define_tasks</a>&nbsp;&nbsp;
      <a href="#M000175">new</a>&nbsp;&nbsp;
      <a href="#M000179">new</a>&nbsp;&nbsp;
      <a href="#M000178">silence</a>&nbsp;&nbsp;
      <a href="#M000174">silence</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





    <div id="attribute-list">
      <h3 class="section-bar">Attributes</h3>

      <div class="name-list">
        <table>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">author</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">author</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">bin_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">bin_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">certificate_chain</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">certificate_chain</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changelog</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changelog</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changelog_patterns</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changelog_patterns</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changes</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">changes</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">clean_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">clean_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">description</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">description</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">development_dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">development_dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">docs_host</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">docs_host</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">email</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">email</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">eval</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">eval</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">executable_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">executable_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extension_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extension_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extensions</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extensions</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extra_deps</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">extra_deps</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gem_bin</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gem_bin</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gemspec_format</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gemspec_format</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gemspec_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">gemspec_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">has_rdoc</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">has_rdoc</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ignore_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ignore_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">include_gemspec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">include_gemspec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">include_rakefile</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">include_rakefile</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">install_message</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">install_message</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lib_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">lib_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">manifest_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">manifest_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_gem</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_gem</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_tar_gz</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_tar_gz</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_tgz</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_tgz</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_zip</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">need_zip</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">platform</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">platform</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">private_key</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">private_key</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">project</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">project</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rakefile_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rakefile_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rcov_options</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rcov_options</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
legacy

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_options</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_options</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_template</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rdoc_template</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">require_signed</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">require_signed</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">retain_gemspec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">retain_gemspec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ruby_version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">ruby_version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rubyforge_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rubyforge_name</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rubygems_version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">rubygems_version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">runtime_dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">runtime_dependencies</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">spec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">spec</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">summary</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">summary</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">test_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">test_files</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">test_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">test_pattern</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">url</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">url</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">use_sudo</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">use_sudo</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
best left alone

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        <tr class="top-aligned-row context-row">
          <td class="context-item-name">version</td>
          <td class="context-item-value">&nbsp;[RW]&nbsp;</td>
          <td class="context-item-desc">
user-configurable

</td>
        </tr>
        </table>
      </div>
    </div>
      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M000175" class="method-detail">
        <a name="M000175"></a>

        <div class="method-heading">
          <a href="#M000175" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(name, _version = nil) {|self if block_given?| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000175-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000175-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 158</span>
158:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">_version</span> = <span class="ruby-keyword kw">nil</span>)
159:     <span class="ruby-comment cmt"># Defaults</span>
160: 
161:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>
162:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>
163:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changelog</span> = <span class="ruby-value str">&quot;CHANGELOG&quot;</span>
164:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">url</span> = <span class="ruby-value str">&quot;&quot;</span>
165:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">author</span> = <span class="ruby-value str">&quot;&quot;</span>
166:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">email</span> = <span class="ruby-value str">&quot;&quot;</span>
167:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean_pattern</span> = [<span class="ruby-value str">&quot;pkg&quot;</span>, <span class="ruby-value str">&quot;doc&quot;</span>, <span class="ruby-value str">'build/*'</span>, <span class="ruby-value str">'**/coverage'</span>, <span class="ruby-value str">'**/*.o'</span>, <span class="ruby-value str">'**/*.so'</span>, <span class="ruby-value str">'**/*.a'</span>, <span class="ruby-value str">'**/*.log'</span>, <span class="ruby-value str">&quot;{ext,lib}/*.{bundle,so,obj,pdb,lib,def,exp}&quot;</span>, <span class="ruby-value str">&quot;ext/Makefile&quot;</span>, <span class="ruby-value str">&quot;{ext,lib}/**/*.{bundle,so,obj,pdb,lib,def,exp}&quot;</span>, <span class="ruby-value str">&quot;ext/**/Makefile&quot;</span>, <span class="ruby-value str">&quot;pkg&quot;</span>, <span class="ruby-value str">&quot;*.gem&quot;</span>, <span class="ruby-value str">&quot;.config&quot;</span>]
168:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_pattern</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-value str">&quot;test/test_all.rb&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;test/test_all.rb&quot;</span> <span class="ruby-operator">:</span> [<span class="ruby-value str">'test/**/test_*.rb'</span>, <span class="ruby-value str">'test/**/*_test.rb'</span>]
169:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ignore_pattern</span> = <span class="ruby-regexp re">/^(pkg|doc)|\.svn|CVS|\.bzr|\.DS|\.git/</span>
170: 
171:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changelog_patterns</span> = {
172:         <span class="ruby-identifier">:version</span> =<span class="ruby-operator">&gt;</span> [
173:             <span class="ruby-regexp re">/^\s*v([\d\.]+)(\.|\s|$)/</span>,
174:             <span class="ruby-regexp re">/\s*\*\s*([\d\.]+)\s*\*\s*$/</span>
175:           ],
176:         <span class="ruby-identifier">:changes</span> =<span class="ruby-operator">&gt;</span> [
177:           <span class="ruby-regexp re">/^\s*v([\d\.]+\. .*)/</span>,
178:           <span class="ruby-regexp re">/\*\s*[\d\.]+\s*\*\s*(.*)\*\s*[\d\.]+\s*\*$/</span><span class="ruby-identifier">m</span>
179:         ]
180:       }
181: 
182:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;&quot;</span>
183:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-value str">&quot;&quot;</span>
184:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">install_message</span> = <span class="ruby-keyword kw">nil</span>
185:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">executable_pattern</span> = <span class="ruby-regexp re">/^bin\//</span>
186:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_rdoc</span> = <span class="ruby-keyword kw">true</span>
187:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_sudo</span> = <span class="ruby-operator">!</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">windows?</span>
188:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gem_bin</span> = <span class="ruby-node">&quot;gem#{Platform.suffix}&quot;</span>
189:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rcov_options</span> = []
190:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-regexp re">/^(lib|bin|tasks|ext)|^README|^CHANGELOG|^TODO|^LICENSE|^COPYING$/</span>
191: 
192:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gemspec_format</span> = <span class="ruby-identifier">:ruby</span>
193: 
194:     <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">capitalize</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">name</span>)
195:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_options</span> = [<span class="ruby-value str">'--line-numbers'</span>, <span class="ruby-value str">'--inline-source'</span>, <span class="ruby-value str">'--title'</span>, <span class="ruby-identifier">title</span>]
196: 
197:     <span class="ruby-identifier">readme</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'*'</span>].<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filename</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^readme/i</span> }
198:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_options</span> <span class="ruby-operator">+=</span> [<span class="ruby-value str">'--main'</span>, <span class="ruby-identifier">readme</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">readme</span>
199: 
200:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = []
201:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">development_dependencies</span> = [] <span class="ruby-comment cmt"># These appear to not work at all</span>
202:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">manifest_name</span> = <span class="ruby-value str">&quot;Manifest&quot;</span>
203:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = [<span class="ruby-value str">&quot;ext/**/extconf.rb&quot;</span>, <span class="ruby-value str">&quot;ext/extconf.rb&quot;</span>]
204:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">private_key</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_PRIVATE_KEY'</span>]
205:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">require_signed</span> = <span class="ruby-keyword kw">false</span>
206:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">certificate_chain</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_CERTIFICATE_CHAIN'</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\,\s*/</span>).<span class="ruby-identifier">compact</span>
207: 
208:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_gem</span> = <span class="ruby-keyword kw">true</span>
209:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_tar_gz</span> = <span class="ruby-keyword kw">true</span>
210:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_tgz</span> = <span class="ruby-keyword kw">false</span>
211:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_zip</span> = <span class="ruby-keyword kw">false</span>
212:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-identifier">$platform</span>
213: 
214:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">include_rakefile</span> = <span class="ruby-keyword kw">true</span>
215:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">include_gemspec</span> = <span class="ruby-keyword kw">true</span>
216:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gemspec_name</span> = <span class="ruby-node">&quot;#{name}.gemspec&quot;</span>
217:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">retain_gemspec</span> = <span class="ruby-keyword kw">false</span>
218:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rakefile_name</span> = <span class="ruby-value str">&quot;Rakefile&quot;</span>
219:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rubygems_version</span> = <span class="ruby-value str">&quot;&gt;= 1.2&quot;</span>
220: 
221:     <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
222: 
223:     <span class="ruby-comment cmt"># legacy compatibility</span>
224:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = <span class="ruby-identifier">dependencies</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dependencies</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">empty?</span>
225:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = <span class="ruby-identifier">extra_deps</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extra_deps</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">empty?</span>
226:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> = <span class="ruby-identifier">rubyforge_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubyforge_name</span>
227:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-identifier">rdoc_files</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rdoc_files</span>
228:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = <span class="ruby-identifier">extensions</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extensions</span>
229: 
230:     <span class="ruby-comment cmt"># read manifest</span>
231:     <span class="ruby-keyword kw">begin</span>
232:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">manifest_name</span>).<span class="ruby-identifier">split</span> <span class="ruby-operator">+</span>
233:         [(<span class="ruby-identifier">gemspec_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span>)] <span class="ruby-operator">+</span>
234:         [(<span class="ruby-identifier">rakefile_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_rakefile</span>)]
235:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
236:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
237:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">&quot;manifest&quot;</span>
238:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Missing manifest. You can build one with 'rake manifest'.&quot;</span>
239:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
240:       <span class="ruby-keyword kw">else</span>
241:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = []
242:       <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-keyword kw">end</span>
244: 
245:     <span class="ruby-comment cmt"># snag version and changeset</span>
246:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">_version</span>
247:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">version</span>
248:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">changelog</span>
249:         <span class="ruby-identifier">parsed</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">changelog_patterns</span>[<span class="ruby-identifier">:version</span>]).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
250:           <span class="ruby-identifier">open</span>(<span class="ruby-identifier">changelog</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">log</span><span class="ruby-operator">|</span>
251:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">read</span>[<span class="ruby-identifier">pattern</span>, <span class="ruby-value">1</span>]
252:           <span class="ruby-keyword kw">end</span>
253:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">first</span>
254:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Could not parse version from #{changelog}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">parsed</span>
255:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">strip</span>
256:       <span class="ruby-keyword kw">else</span>
257:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;No #{changelog} found, and no version supplied in Rakefile.&quot;</span>
258:       <span class="ruby-keyword kw">end</span>
259:     <span class="ruby-keyword kw">end</span>
260: 
261:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changes</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">changelog</span>
262:       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">changelog_patterns</span>[<span class="ruby-identifier">:changes</span>]).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
263:         <span class="ruby-identifier">open</span>(<span class="ruby-identifier">changelog</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">log</span><span class="ruby-operator">|</span>
264:           <span class="ruby-identifier">log</span>.<span class="ruby-identifier">read</span>[<span class="ruby-identifier">pattern</span>, <span class="ruby-value">1</span>]
265:         <span class="ruby-keyword kw">end</span>
266:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">or</span> <span class="ruby-value str">&quot;&quot;</span>
267:     <span class="ruby-keyword kw">else</span>
268:       <span class="ruby-value str">&quot;&quot;</span>
269:     <span class="ruby-keyword kw">end</span>
270: 
271:     <span class="ruby-comment cmt"># set some post-defaults</span>
272:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">certificate_chain</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">certificate_chain</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">file</span>)}
273:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">private_key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">private_key</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span>
274:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">summary</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">description</span>.<span class="ruby-identifier">empty?</span>
275:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-identifier">description</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">summary</span>.<span class="ruby-identifier">empty?</span>
276:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">clean_pattern</span>)
277:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">extension_pattern</span>, <span class="ruby-identifier">files</span>)
278:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ignore_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">ignore_pattern</span>)
279:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">rdoc_pattern</span>, <span class="ruby-identifier">files</span>) <span class="ruby-operator">-</span> [<span class="ruby-identifier">manifest_name</span>]
280:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">executable_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">executable_pattern</span>, <span class="ruby-identifier">files</span>)
281:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">test_pattern</span>)
282: 
283:     <span class="ruby-identifier">define_tasks</span>
284:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000179" class="method-detail">
        <a name="M000179"></a>

        <div class="method-heading">
          <a href="#M000179" class="method-signature">
          <span class="method-name">new</span><span class="method-args">(name, _version = nil) {|self if block_given?| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000179-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000179-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 158</span>
158:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">name</span>, <span class="ruby-identifier">_version</span> = <span class="ruby-keyword kw">nil</span>)
159:     <span class="ruby-comment cmt"># Defaults</span>
160: 
161:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>
162:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> = <span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span>
163:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changelog</span> = <span class="ruby-value str">&quot;CHANGELOG&quot;</span>
164:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">url</span> = <span class="ruby-value str">&quot;&quot;</span>
165:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">author</span> = <span class="ruby-value str">&quot;&quot;</span>
166:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">email</span> = <span class="ruby-value str">&quot;&quot;</span>
167:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean_pattern</span> = [<span class="ruby-value str">&quot;pkg&quot;</span>, <span class="ruby-value str">&quot;doc&quot;</span>, <span class="ruby-value str">'build/*'</span>, <span class="ruby-value str">'**/coverage'</span>, <span class="ruby-value str">'**/*.o'</span>, <span class="ruby-value str">'**/*.so'</span>, <span class="ruby-value str">'**/*.a'</span>, <span class="ruby-value str">'**/*.log'</span>, <span class="ruby-value str">&quot;{ext,lib}/*.{bundle,so,obj,pdb,lib,def,exp}&quot;</span>, <span class="ruby-value str">&quot;ext/Makefile&quot;</span>, <span class="ruby-value str">&quot;{ext,lib}/**/*.{bundle,so,obj,pdb,lib,def,exp}&quot;</span>, <span class="ruby-value str">&quot;ext/**/Makefile&quot;</span>, <span class="ruby-value str">&quot;pkg&quot;</span>, <span class="ruby-value str">&quot;*.gem&quot;</span>, <span class="ruby-value str">&quot;.config&quot;</span>]
168:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_pattern</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-value str">&quot;test/test_all.rb&quot;</span>) <span class="ruby-operator">?</span> <span class="ruby-value str">&quot;test/test_all.rb&quot;</span> <span class="ruby-operator">:</span> [<span class="ruby-value str">'test/**/test_*.rb'</span>, <span class="ruby-value str">'test/**/*_test.rb'</span>]
169:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ignore_pattern</span> = <span class="ruby-regexp re">/^(pkg|doc)|\.svn|CVS|\.bzr|\.DS|\.git/</span>
170: 
171:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changelog_patterns</span> = {
172:         <span class="ruby-identifier">:version</span> =<span class="ruby-operator">&gt;</span> [
173:             <span class="ruby-regexp re">/^\s*v([\d\.]+)(\.|\s|$)/</span>,
174:             <span class="ruby-regexp re">/\s*\*\s*([\d\.]+)\s*\*\s*$/</span>
175:           ],
176:         <span class="ruby-identifier">:changes</span> =<span class="ruby-operator">&gt;</span> [
177:           <span class="ruby-regexp re">/^\s*v([\d\.]+\. .*)/</span>,
178:           <span class="ruby-regexp re">/\*\s*[\d\.]+\s*\*\s*(.*)\*\s*[\d\.]+\s*\*$/</span><span class="ruby-identifier">m</span>
179:         ]
180:       }
181: 
182:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-value str">&quot;&quot;</span>
183:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-value str">&quot;&quot;</span>
184:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">install_message</span> = <span class="ruby-keyword kw">nil</span>
185:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">executable_pattern</span> = <span class="ruby-regexp re">/^bin\//</span>
186:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">has_rdoc</span> = <span class="ruby-keyword kw">true</span>
187:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">use_sudo</span> = <span class="ruby-operator">!</span><span class="ruby-constant">Platform</span>.<span class="ruby-identifier">windows?</span>
188:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gem_bin</span> = <span class="ruby-node">&quot;gem#{Platform.suffix}&quot;</span>
189:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rcov_options</span> = []
190:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-regexp re">/^(lib|bin|tasks|ext)|^README|^CHANGELOG|^TODO|^LICENSE|^COPYING$/</span>
191: 
192:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gemspec_format</span> = <span class="ruby-identifier">:ruby</span>
193: 
194:     <span class="ruby-identifier">title</span> = (<span class="ruby-identifier">name</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">name</span> <span class="ruby-value">? </span><span class="ruby-identifier">name</span>.<span class="ruby-identifier">capitalize</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">name</span>)
195:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_options</span> = [<span class="ruby-value str">'--line-numbers'</span>, <span class="ruby-value str">'--inline-source'</span>, <span class="ruby-value str">'--title'</span>, <span class="ruby-identifier">title</span>]
196: 
197:     <span class="ruby-identifier">readme</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'*'</span>].<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">filename</span><span class="ruby-operator">|</span> <span class="ruby-identifier">filename</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^readme/i</span> }
198:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_options</span> <span class="ruby-operator">+=</span> [<span class="ruby-value str">'--main'</span>, <span class="ruby-identifier">readme</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">readme</span>
199: 
200:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = []
201:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">development_dependencies</span> = [] <span class="ruby-comment cmt"># These appear to not work at all</span>
202:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">manifest_name</span> = <span class="ruby-value str">&quot;Manifest&quot;</span>
203:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = [<span class="ruby-value str">&quot;ext/**/extconf.rb&quot;</span>, <span class="ruby-value str">&quot;ext/extconf.rb&quot;</span>]
204:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">private_key</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_PRIVATE_KEY'</span>]
205:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">require_signed</span> = <span class="ruby-keyword kw">false</span>
206:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">certificate_chain</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'GEM_CERTIFICATE_CHAIN'</span>].<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp re">/\,\s*/</span>).<span class="ruby-identifier">compact</span>
207: 
208:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_gem</span> = <span class="ruby-keyword kw">true</span>
209:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_tar_gz</span> = <span class="ruby-keyword kw">true</span>
210:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_tgz</span> = <span class="ruby-keyword kw">false</span>
211:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">need_zip</span> = <span class="ruby-keyword kw">false</span>
212:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-identifier">$platform</span>
213: 
214:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">include_rakefile</span> = <span class="ruby-keyword kw">true</span>
215:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">include_gemspec</span> = <span class="ruby-keyword kw">true</span>
216:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">gemspec_name</span> = <span class="ruby-node">&quot;#{name}.gemspec&quot;</span>
217:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">retain_gemspec</span> = <span class="ruby-keyword kw">false</span>
218:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rakefile_name</span> = <span class="ruby-value str">&quot;Rakefile&quot;</span>
219:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rubygems_version</span> = <span class="ruby-value str">&quot;&gt;= 1.2&quot;</span>
220: 
221:     <span class="ruby-keyword kw">yield</span> <span class="ruby-keyword kw">self</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>
222: 
223:     <span class="ruby-comment cmt"># legacy compatibility</span>
224:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = <span class="ruby-identifier">dependencies</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dependencies</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">empty?</span>
225:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">runtime_dependencies</span> = <span class="ruby-identifier">extra_deps</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extra_deps</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">empty?</span>
226:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">project</span> = <span class="ruby-identifier">rubyforge_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubyforge_name</span>
227:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-identifier">rdoc_files</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rdoc_files</span>
228:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = <span class="ruby-identifier">extensions</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extensions</span>
229: 
230:     <span class="ruby-comment cmt"># read manifest</span>
231:     <span class="ruby-keyword kw">begin</span>
232:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">manifest_name</span>).<span class="ruby-identifier">split</span> <span class="ruby-operator">+</span>
233:         [(<span class="ruby-identifier">gemspec_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span>)] <span class="ruby-operator">+</span>
234:         [(<span class="ruby-identifier">rakefile_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_rakefile</span>)]
235:       <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">uniq</span>
236:     <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
237:       <span class="ruby-keyword kw">unless</span> <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">include?</span> <span class="ruby-value str">&quot;manifest&quot;</span>
238:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Missing manifest. You can build one with 'rake manifest'.&quot;</span>
239:         <span class="ruby-identifier">exit</span> <span class="ruby-value">1</span>
240:       <span class="ruby-keyword kw">else</span>
241:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">files</span> = []
242:       <span class="ruby-keyword kw">end</span>
243:     <span class="ruby-keyword kw">end</span>
244: 
245:     <span class="ruby-comment cmt"># snag version and changeset</span>
246:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">_version</span>
247:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">version</span>
248:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">changelog</span>
249:         <span class="ruby-identifier">parsed</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">changelog_patterns</span>[<span class="ruby-identifier">:version</span>]).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
250:           <span class="ruby-identifier">open</span>(<span class="ruby-identifier">changelog</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">log</span><span class="ruby-operator">|</span>
251:             <span class="ruby-identifier">log</span>.<span class="ruby-identifier">read</span>[<span class="ruby-identifier">pattern</span>, <span class="ruby-value">1</span>]
252:           <span class="ruby-keyword kw">end</span>
253:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">first</span>
254:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Could not parse version from #{changelog}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">parsed</span>
255:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">parsed</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">strip</span>
256:       <span class="ruby-keyword kw">else</span>
257:         <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;No #{changelog} found, and no version supplied in Rakefile.&quot;</span>
258:       <span class="ruby-keyword kw">end</span>
259:     <span class="ruby-keyword kw">end</span>
260: 
261:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">changes</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">changelog</span>
262:       <span class="ruby-constant">Array</span>(<span class="ruby-identifier">changelog_patterns</span>[<span class="ruby-identifier">:changes</span>]).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pattern</span><span class="ruby-operator">|</span>
263:         <span class="ruby-identifier">open</span>(<span class="ruby-identifier">changelog</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">log</span><span class="ruby-operator">|</span>
264:           <span class="ruby-identifier">log</span>.<span class="ruby-identifier">read</span>[<span class="ruby-identifier">pattern</span>, <span class="ruby-value">1</span>]
265:         <span class="ruby-keyword kw">end</span>
266:       <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">compact</span>.<span class="ruby-identifier">first</span> <span class="ruby-keyword kw">or</span> <span class="ruby-value str">&quot;&quot;</span>
267:     <span class="ruby-keyword kw">else</span>
268:       <span class="ruby-value str">&quot;&quot;</span>
269:     <span class="ruby-keyword kw">end</span>
270: 
271:     <span class="ruby-comment cmt"># set some post-defaults</span>
272:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">certificate_chain</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">certificate_chain</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">file</span>)}
273:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">private_key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">private_key</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span>
274:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">summary</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">description</span>.<span class="ruby-identifier">empty?</span>
275:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-identifier">description</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">summary</span>.<span class="ruby-identifier">empty?</span>
276:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">clean_pattern</span>)
277:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">extension_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">extension_pattern</span>, <span class="ruby-identifier">files</span>)
278:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">ignore_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">ignore_pattern</span>)
279:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">rdoc_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">rdoc_pattern</span>, <span class="ruby-identifier">files</span>) <span class="ruby-operator">-</span> [<span class="ruby-identifier">manifest_name</span>]
280:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">executable_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">executable_pattern</span>, <span class="ruby-identifier">files</span>)
281:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_pattern</span> = <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">test_pattern</span>)
282: 
283:     <span class="ruby-identifier">define_tasks</span>
284:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000178" class="method-detail">
        <a name="M000178"></a>

        <div class="method-heading">
          <a href="#M000178" class="method-signature">
          <span class="method-name">silence</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000178-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000178-source">
<pre>
    <span class="ruby-comment cmt"># File lib/echoe/extensions.rb, line 14</span>
14:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">silence</span>
15:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">ENV</span>[<span class="ruby-value str">'VERBOSE'</span>]      
16:       <span class="ruby-identifier">stdout</span>, <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">clone</span>, <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">clone</span>
17:       <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'/tmp/stdout.echoe'</span>, <span class="ruby-value str">'w'</span>))
18:       <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'/tmp/stderr.echoe'</span>, <span class="ruby-value str">'w'</span>))
19:       <span class="ruby-keyword kw">begin</span>
20:         <span class="ruby-keyword kw">yield</span>
21:       <span class="ruby-keyword kw">ensure</span>
22:         <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-identifier">stdout</span>)
23:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-identifier">stderr</span>)
24:       <span class="ruby-keyword kw">end</span>
25:     <span class="ruby-keyword kw">else</span>
26:       <span class="ruby-keyword kw">yield</span>
27:     <span class="ruby-keyword kw">end</span>
28:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000174" class="method-detail">
        <a name="M000174"></a>

        <div class="method-heading">
          <a href="#M000174" class="method-signature">
          <span class="method-name">silence</span><span class="method-args">() {|| ...}</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000174-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000174-source">
<pre>
    <span class="ruby-comment cmt"># File lib/echoe/extensions.rb, line 14</span>
14:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">silence</span>
15:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">ENV</span>[<span class="ruby-value str">'VERBOSE'</span>]      
16:       <span class="ruby-identifier">stdout</span>, <span class="ruby-identifier">stderr</span> = <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">clone</span>, <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">clone</span>
17:       <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'/tmp/stdout.echoe'</span>, <span class="ruby-value str">'w'</span>))
18:       <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'/tmp/stderr.echoe'</span>, <span class="ruby-value str">'w'</span>))
19:       <span class="ruby-keyword kw">begin</span>
20:         <span class="ruby-keyword kw">yield</span>
21:       <span class="ruby-keyword kw">ensure</span>
22:         <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-identifier">stdout</span>)
23:         <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">reopen</span>(<span class="ruby-identifier">stderr</span>)
24:       <span class="ruby-keyword kw">end</span>
25:     <span class="ruby-keyword kw">else</span>
26:       <span class="ruby-keyword kw">yield</span>
27:     <span class="ruby-keyword kw">end</span>
28:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000176" class="method-detail">
        <a name="M000176"></a>

        <div class="method-heading">
          <a href="#M000176" class="method-signature">
          <span class="method-name">apply_pattern</span><span class="method-args">(pattern, files = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000176-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000176-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 286</span>
286:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">files</span> = <span class="ruby-keyword kw">nil</span>)
287:     <span class="ruby-identifier">files</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'**/**'</span>]
288:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">pattern</span>
289:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Array</span>
290:         <span class="ruby-identifier">files</span> <span class="ruby-operator">&amp;</span> (<span class="ruby-constant">Array</span>(<span class="ruby-identifier">pattern</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
291:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">p</span>)
292:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>)
293:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Regexp</span>
294:         <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
295:           <span class="ruby-identifier">file</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">pattern</span>
296:         <span class="ruby-keyword kw">end</span>
297:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FileList</span>
298:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ignorefile</span><span class="ruby-operator">|</span>
299:           <span class="ruby-identifier">ignorefiles</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">ignorefile</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:chomp</span>)
300:           <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
301:             <span class="ruby-identifier">ignorefiles</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">file</span>) }.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword kw">true</span>)
302:           <span class="ruby-keyword kw">end</span>
303:         <span class="ruby-keyword kw">end</span>
304:         <span class="ruby-identifier">files</span>
305:       <span class="ruby-keyword kw">else</span>
306:         []
307:     <span class="ruby-keyword kw">end</span>
308:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000180" class="method-detail">
        <a name="M000180"></a>

        <div class="method-heading">
          <a href="#M000180" class="method-signature">
          <span class="method-name">apply_pattern</span><span class="method-args">(pattern, files = nil)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000180-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000180-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 286</span>
286:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">apply_pattern</span>(<span class="ruby-identifier">pattern</span>, <span class="ruby-identifier">files</span> = <span class="ruby-keyword kw">nil</span>)
287:     <span class="ruby-identifier">files</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'**/**'</span>]
288:     <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">pattern</span>
289:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">String</span>, <span class="ruby-constant">Array</span>
290:         <span class="ruby-identifier">files</span> <span class="ruby-operator">&amp;</span> (<span class="ruby-constant">Array</span>(<span class="ruby-identifier">pattern</span>).<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
291:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">glob</span>(<span class="ruby-identifier">p</span>)
292:         <span class="ruby-keyword kw">end</span>.<span class="ruby-identifier">flatten</span>)
293:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">Regexp</span>
294:         <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
295:           <span class="ruby-identifier">file</span> <span class="ruby-operator">=~</span> <span class="ruby-identifier">pattern</span>
296:         <span class="ruby-keyword kw">end</span>
297:       <span class="ruby-keyword kw">when</span> <span class="ruby-constant">FileList</span>
298:         <span class="ruby-identifier">pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ignorefile</span><span class="ruby-operator">|</span>
299:           <span class="ruby-identifier">ignorefiles</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">ignorefile</span>).<span class="ruby-identifier">to_a</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-identifier">:chomp</span>)
300:           <span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>.<span class="ruby-identifier">select</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
301:             <span class="ruby-identifier">ignorefiles</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">fnmatch</span>(<span class="ruby-identifier">i</span>, <span class="ruby-identifier">file</span>) }.<span class="ruby-identifier">include?</span>(<span class="ruby-keyword kw">true</span>)
302:           <span class="ruby-keyword kw">end</span>
303:         <span class="ruby-keyword kw">end</span>
304:         <span class="ruby-identifier">files</span>
305:       <span class="ruby-keyword kw">else</span>
306:         []
307:     <span class="ruby-keyword kw">end</span>
308:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000181" class="method-detail">
        <a name="M000181"></a>

        <div class="method-heading">
          <a href="#M000181" class="method-signature">
          <span class="method-name">define_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000181-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000181-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 310</span>
310:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_tasks</span>
311: 
312:     <span class="ruby-comment cmt">### Packaging and Installing</span>
313: 
314:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
315:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>
316:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">version</span>
317:       <span class="ruby-comment cmt"># s.specification_version = 3</span>
318:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-identifier">summary</span>
319:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">author</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
320:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">email</span>
321:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span> = <span class="ruby-identifier">url</span>
322:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">rubyforge_project</span> = <span class="ruby-identifier">project</span>
323:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">post_install_message</span> = <span class="ruby-identifier">install_message</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">install_message</span>
324:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">description</span>
325:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">required_ruby_version</span> = <span class="ruby-identifier">ruby_version</span>
326:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">required_rubygems_version</span> = <span class="ruby-identifier">rubygems_version</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubygems_version</span>
327:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-identifier">platform</span>
328:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">rdoc_options</span> = <span class="ruby-identifier">rdoc_options</span>
329:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">extra_rdoc_files</span> = <span class="ruby-identifier">rdoc_pattern</span>
330: 
331:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">private_key</span>
332:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">signing_key</span> = <span class="ruby-identifier">private_key</span>
333:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-identifier">certificate_chain</span>
334:       <span class="ruby-keyword kw">end</span>
335: 
336:       <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dep</span><span class="ruby-operator">|</span>
337:         <span class="ruby-identifier">dep</span> = <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
338:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_runtime_dependency</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">dep</span>)
339:       <span class="ruby-keyword kw">end</span>
340: 
341:       <span class="ruby-identifier">development_dependencies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dep</span><span class="ruby-operator">|</span>
342:         <span class="ruby-identifier">dep</span> = <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
343:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_development_dependency</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">dep</span>)
344:       <span class="ruby-keyword kw">end</span>
345: 
346:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>
347: 
348:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">bindir</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">executable_pattern</span>.<span class="ruby-identifier">any?</span>
349:         <span class="ruby-identifier">executable_pattern</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;/&quot;</span>)[<span class="ruby-value">0</span>]
350:       <span class="ruby-keyword kw">else</span>
351:         <span class="ruby-value str">&quot;bin&quot;</span>
352:       <span class="ruby-keyword kw">end</span>
353: 
354:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">executables</span> = <span class="ruby-identifier">executable_pattern</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
355:         <span class="ruby-identifier">file</span>[(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)<span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
356:       <span class="ruby-keyword kw">end</span>
357: 
358:       <span class="ruby-identifier">dirs</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'{lib,ext}'</span>]
359:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">extensions</span> = <span class="ruby-identifier">extension_pattern</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">any?</span>
360:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-identifier">dirs</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">empty?</span>
361:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">has_rdoc</span> = <span class="ruby-identifier">has_rdoc</span>
362: 
363:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">&quot;test/test_all.rb&quot;</span>
364:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">test_file</span> = <span class="ruby-value str">&quot;test/test_all.rb&quot;</span>
365:       <span class="ruby-keyword kw">else</span>
366:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
367:       <span class="ruby-keyword kw">end</span>
368: 
369:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">eval</span>
370:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">eval</span>
371:       <span class="ruby-keyword kw">end</span>
372: 
373:     <span class="ruby-keyword kw">end</span>
374: 
375:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lib_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^lib/</span>)
376:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">bin_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^bin/</span>)
377:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^test/</span>)
378: 
379:     <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">GemPackageTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pkg</span><span class="ruby-operator">|</span>
380:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_tar</span> = <span class="ruby-ivar">@need_tgz</span>
381:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_tar_gz</span> = <span class="ruby-ivar">@need_tar_gz</span>
382:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_zip</span> = <span class="ruby-ivar">@need_zip</span>
383:     <span class="ruby-keyword kw">end</span>
384:     
385:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Display Echoe's knowledge of your system&quot;</span>
386:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:details</span> <span class="ruby-keyword kw">do</span>
387:       (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">-</span> [<span class="ruby-value str">'@spec'</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span><span class="ruby-operator">|</span>
388:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{var}: #{instance_variable_get(var).inspect}&quot;</span>
389:       <span class="ruby-keyword kw">end</span>
390:     <span class="ruby-keyword kw">end</span>
391: 
392:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:build_gemspec</span> <span class="ruby-keyword kw">do</span>
393:       <span class="ruby-comment cmt"># Construct the gemspec file, if needed.</span>
394:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span>
395:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">gemspec_name</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>          
396:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">gemspec_format</span>
397:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:yaml</span>
398:             <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_yaml</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
399:               <span class="ruby-comment cmt"># Don't publish any information about the private key or certificate chain</span>
400:               <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/signing_key|cert_chain|\.pem/</span>
401:             <span class="ruby-keyword kw">end</span>          
402:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:ruby</span>
403:             <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby</span>
404:           <span class="ruby-keyword kw">else</span>
405:             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown gemspec format #{gemspec_format.inspect}. Supported formats: :ruby and :yaml&quot;</span>
406:           <span class="ruby-keyword kw">end</span>
407:         <span class="ruby-keyword kw">end</span>
408:       <span class="ruby-keyword kw">end</span>
409:     <span class="ruby-keyword kw">end</span>
410: 
411:     <span class="ruby-comment cmt"># Chain it to the gemspec task prerequisite</span>
412:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">gemspec_name</span>.<span class="ruby-identifier">to_sym</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:build_gemspec</span>]
413: 
414:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:package</span> <span class="ruby-keyword kw">do</span>
415:       <span class="ruby-comment cmt"># Chain some cleanup tasks to the default :package task.</span>
416:       <span class="ruby-comment cmt"># Remove the gemfile if it wasn't actually requested.</span>
417:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@need_gem</span>
418:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;  Gem file not requested. Removed.&quot;</span>
419:         <span class="ruby-identifier">system</span> <span class="ruby-value str">&quot;rm pkg/*.gem&quot;</span>
420:       <span class="ruby-keyword kw">end</span>
421:       <span class="ruby-comment cmt"># Remove the generated gemspec once the packaging is done, to discourage people from modifying it by hand.</span>
422:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">gemspec_name</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">retain_gemspec</span>
423:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">gemspec_name</span>
424:       <span class="ruby-keyword kw">end</span>
425: 
426:       <span class="ruby-comment cmt"># Test signing status</span>
427:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">private_key</span>
428:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Signing gem.&quot;</span>
429:       <span class="ruby-keyword kw">else</span>
430:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Key required, but not found. Maybe you forget to set ENV['GEM_PRIVATE_KEY']?&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">require_signed</span>
431:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Private key not found; gem will not be signed.&quot;</span>
432:       <span class="ruby-keyword kw">end</span>
433:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Targeting \&quot;#{platform}\&quot; platform.&quot;</span>
434:     <span class="ruby-keyword kw">end</span>
435: 
436:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Install the gem'</span>
437:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:install</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>, <span class="ruby-identifier">:uninstall</span>] <span class="ruby-keyword kw">do</span>
438:       <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} install pkg/*.gem -P MediumSecurity --no-update-sources&quot;</span>
439:     <span class="ruby-keyword kw">end</span>
440: 
441:     <span class="ruby-identifier">namespace</span> <span class="ruby-identifier">:install</span> <span class="ruby-keyword kw">do</span>
442:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Install the gem including development dependencies'</span>
443:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:development</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>, <span class="ruby-identifier">:uninstall</span>] <span class="ruby-keyword kw">do</span>
444:         <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} install pkg/*.gem -P MediumSecurity --no-update-sources --development&quot;</span>
445:       <span class="ruby-keyword kw">end</span>
446:     <span class="ruby-keyword kw">end</span>
447: 
448:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Uninstall the gem'</span>
449:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:uninstall</span> <span class="ruby-keyword kw">do</span>
450:       <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} uninstall #{name} -a -I -x&quot;</span>
451:     <span class="ruby-keyword kw">end</span>
452: 
453:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Package and upload the release to Rubyforge'</span>
454:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:release</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>] <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
455: 
456:       <span class="ruby-identifier">say</span> <span class="ruby-value str">&quot;\n&quot;</span>
457:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agree</span> <span class="ruby-node">&quot;Release #{name}-#{version} to Rubyforge? &quot;</span>
458:         <span class="ruby-identifier">pkg</span> = <span class="ruby-node">&quot;pkg/#{name}-#{version}&quot;</span>
459:         <span class="ruby-identifier">pkg_gem</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.gem&quot;</span>
460:         <span class="ruby-identifier">pkg_tar</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tgz&quot;</span>
461:         <span class="ruby-identifier">pkg_tar_gz</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tar.gz&quot;</span>
462:         <span class="ruby-identifier">pkg_zip</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.zip&quot;</span>
463: 
464:         <span class="ruby-identifier">rf</span> = <span class="ruby-constant">RubyForge</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">configure</span>
465:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Logging in&quot;</span>
466:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">login</span>
467: 
468:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">userconfig</span>
469:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;release_notes&quot;</span>] = <span class="ruby-identifier">description</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">description</span>
470:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;release_changes&quot;</span>] = <span class="ruby-identifier">changes</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">changes</span>
471:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;preformatted&quot;</span>] = <span class="ruby-keyword kw">false</span>
472: 
473:         <span class="ruby-identifier">files</span> = [(<span class="ruby-ivar">@need_tgz</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_tar</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
474:                   (<span class="ruby-ivar">@need_tar_gz</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_tar_gz</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
475:                   (<span class="ruby-ivar">@need_zip</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_zip</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
476:                   (<span class="ruby-ivar">@need_gem</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_gem</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>)].<span class="ruby-identifier">compact</span>
477: 
478:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Releasing #{name} v. #{version}&quot;</span>
479:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">ljust</span>(<span class="ruby-value">3</span>)
480: 
481:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">add_release</span> <span class="ruby-identifier">project</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>
482:       <span class="ruby-keyword kw">end</span>
483: 
484:     <span class="ruby-keyword kw">end</span>
485: 
486:     <span class="ruby-comment cmt">### Extension building</span>
487: 
488:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:lib</span> <span class="ruby-keyword kw">do</span>
489:       <span class="ruby-identifier">directory</span> <span class="ruby-value str">&quot;lib&quot;</span>
490:     <span class="ruby-keyword kw">end</span>
491: 
492:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">any?</span>
493: 
494:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Compile the binary extension module&quot;</span>
495:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:compile</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:lib</span>] <span class="ruby-keyword kw">do</span>
496:         <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">extension</span><span class="ruby-operator">|</span>
497:           <span class="ruby-identifier">ext_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">extension</span>)
498:           <span class="ruby-identifier">lib_target</span> = <span class="ruby-keyword kw">nil</span>
499:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">ext_dir</span>) <span class="ruby-keyword kw">do</span>
500:             <span class="ruby-identifier">ruby</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">extension</span>)
501:             <span class="ruby-identifier">system</span>(<span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/win32/</span> <span class="ruby-operator">?</span> <span class="ruby-value str">'nmake'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'make'</span>)
502:             <span class="ruby-identifier">lib_target</span> = <span class="ruby-identifier">open</span>(<span class="ruby-value str">'Makefile'</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/target_prefix = /</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">strip</span>
503:           <span class="ruby-keyword kw">end</span>
504:           <span class="ruby-constant">Dir</span>[<span class="ruby-node">&quot;#{ext_dir}/*.#{Config::CONFIG['DLEXT']}&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
505:             <span class="ruby-identifier">dir</span> = <span class="ruby-node">&quot;lib/#{lib_target}/&quot;</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'//'</span>, <span class="ruby-value str">'/'</span>)
506:             <span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
507:             <span class="ruby-identifier">cp</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">dir</span>
508:           <span class="ruby-keyword kw">end</span>
509:         <span class="ruby-keyword kw">end</span>
510:       <span class="ruby-keyword kw">end</span>
511: 
512:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:test</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:compile</span>]
513: 
514:     <span class="ruby-keyword kw">end</span>
515: 
516:     <span class="ruby-comment cmt">### Cross-platform targets</span>
517: 
518:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">PLATFORM_CROSS_TARGETS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
519:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">target</span> <span class="ruby-keyword kw">do</span>
520:         <span class="ruby-identifier">reset_target</span> <span class="ruby-identifier">target</span>
521:       <span class="ruby-keyword kw">end</span>
522:     <span class="ruby-keyword kw">end</span>
523: 
524:     <span class="ruby-comment cmt">### Documentation</span>
525: 
526:     <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">RDocTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:docs</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rd</span><span class="ruby-operator">|</span>
527:       <span class="ruby-comment cmt"># rd.main = Dir['*'].detect {|f| f =~ /^readme/i}</span>
528:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">options</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">rdoc_options</span>)
529: 
530:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">rdoc_dir</span> = <span class="ruby-value str">'doc'</span>
531:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">rdoc_files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">rdoc_pattern</span>)
532: 
533:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rdoc_template</span>
534:         <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">template</span> = <span class="ruby-identifier">rdoc_template</span>
535:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RDOC_TEMPLATE'</span>]
536:         <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">template</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RDOC_TEMPLATE'</span>]
537:       <span class="ruby-keyword kw">end</span>
538:     <span class="ruby-keyword kw">end</span>
539: 
540:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:doc</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:redocs</span>]
541: 
542:     <span class="ruby-identifier">desc</span> <span class="ruby-node">&quot;Publish documentation to #{docs_host ? &quot;'#{docs_host}'&quot; : &quot;rubyforge&quot;}&quot;</span>
543:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:publish_docs</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:docs</span>] <span class="ruby-keyword kw">do</span>
544: 
545:       <span class="ruby-identifier">local_dir</span> = <span class="ruby-value str">'doc'</span>
546:       <span class="ruby-identifier">remote_dir_name</span> = <span class="ruby-identifier">project</span>
547:       <span class="ruby-identifier">remote_dir_name</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;/#{name}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">name</span>
548: 
549:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">docs_host</span>
550:         <span class="ruby-identifier">config</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;~/.rubyforge/user-config.yml&quot;</span>)))
551:         <span class="ruby-identifier">pub</span> = <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">SshDirPublisher</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;#{config[&quot;username&quot;]}@rubyforge.org&quot;</span>,
552:           <span class="ruby-node">&quot;/var/www/gforge-projects/#{remote_dir_name}&quot;</span>,
553:           <span class="ruby-identifier">local_dir</span>
554:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">then</span>
555:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pub</span>.<span class="ruby-identifier">upload</span>
556:             <span class="ruby-keyword kw">begin</span>
557:               <span class="ruby-keyword kw">super</span>
558:             <span class="ruby-keyword kw">rescue</span>
559:               <span class="ruby-comment cmt"># project directory probably doesn't exist, transfer as a whole</span>
560:               <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -qr #{local_dir} #{host}:#{remote_dir}&quot;</span>
561:               <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Uploading: #{cmd}&quot;</span>
562:               <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
563:             <span class="ruby-keyword kw">end</span>
564:           <span class="ruby-keyword kw">end</span>
565:         <span class="ruby-keyword kw">end</span>
566:         <span class="ruby-identifier">pub</span>.<span class="ruby-identifier">upload</span>
567:       <span class="ruby-keyword kw">else</span>
568:         <span class="ruby-comment cmt"># you may need ssh keys configured for this to work</span>
569:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">docs_host</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;:&quot;</span>)
570:         <span class="ruby-identifier">dir</span>.<span class="ruby-identifier">chomp!</span>(<span class="ruby-value str">&quot;/&quot;</span>)
571: 
572:         <span class="ruby-comment cmt"># XXX too dangerous?</span>
573:         <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;ssh #{host} 'rm -rf #{dir}/#{remote_dir_name}'&quot;</span>
574:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Deleting existing docs: #{cmd}&quot;</span>
575:         <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
576: 
577:         <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -qr #{local_dir} #{host}:#{dir}/#{remote_dir_name}&quot;</span>
578:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Uploading: #{cmd}&quot;</span>
579:         <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
580:       <span class="ruby-keyword kw">end</span>
581:     <span class="ruby-keyword kw">end</span>
582: 
583:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Generate a release announcement, edit it, and post it to Rubyforge.'</span>
584:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:announce</span> <span class="ruby-keyword kw">do</span>
585: 
586:       <span class="ruby-identifier">filename</span> = <span class="ruby-node">&quot;/tmp/#{name}_#{version}_announcement.txt&quot;</span>
587: 
588:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Overwrite existing announcement file? &quot;</span>
589:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
590:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;Subject: #{name.capitalize} #{version}\n\n&quot;</span>
591:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{name.capitalize} has been updated to #{version}. #{name.capitalize} is #{summary.uncapitalize}\n\n&quot;</span>
592:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;Changes in this version: #{changes.sub(/^\s*[\w\d\.]+\s+/, '').uncapitalize}\n\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">empty?</span>
593:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;More information is available at #{url} .\n\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">empty?</span>
594:         <span class="ruby-keyword kw">end</span>
595:       <span class="ruby-keyword kw">end</span>
596: 
597:       <span class="ruby-keyword kw">begin</span>
598:         <span class="ruby-identifier">editor</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'EDITOR'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'nano'</span>
599:         <span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;#{editor} #{filename}&quot;</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Editor '#{editor}' failed to start&quot;</span>
600:         <span class="ruby-identifier">puts</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">read</span>
601:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Done editing? &quot;</span>
602: 
603:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Publish announcement to Rubyforge? &quot;</span>
604:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Subject: (.*)/</span> }
605:         <span class="ruby-identifier">subject</span> = <span class="ruby-identifier">$1</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Subject line seems to have disappeared&quot;</span>
606: 
607:         <span class="ruby-identifier">body</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Subject: /</span> }.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\n\n\n&quot;</span>, <span class="ruby-value str">&quot;\n\n&quot;</span>)
608: 
609:         <span class="ruby-identifier">rf</span> = <span class="ruby-constant">RubyForge</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">configure</span>
610:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">login</span>
611:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">post_news</span>(<span class="ruby-identifier">project</span>, <span class="ruby-identifier">subject</span>, <span class="ruby-identifier">body</span>)
612:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Published.&quot;</span>
613:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">filename</span>
614:       <span class="ruby-keyword kw">end</span>
615:     <span class="ruby-keyword kw">end</span>
616: 
617:     <span class="ruby-comment cmt">### Clean</span>
618: 
619:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Clean up auto-generated files'</span>
620:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:clean</span> <span class="ruby-keyword kw">do</span>
621:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Cleaning&quot;</span>
622:       <span class="ruby-identifier">clean_pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
623:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
624:           <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;- #{file}&quot;</span>
625:           <span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">file</span>
626:         <span class="ruby-keyword kw">end</span>
627:       <span class="ruby-keyword kw">end</span>
628:     <span class="ruby-keyword kw">end</span>
629: 
630:     <span class="ruby-comment cmt">### Manifest</span>
631: 
632:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Build a Manifest list&quot;</span>
633:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:manifest</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>] <span class="ruby-keyword kw">do</span>
634:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Building Manifest&quot;</span>
635:       <span class="ruby-identifier">old_files</span> = <span class="ruby-identifier">files</span>
636:       <span class="ruby-identifier">files</span> = []
637:       <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'**/**'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
638:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>
639:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ignore_pattern</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
640:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">file</span>)
641:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">include_rakefile</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rakefile_name</span>
642:         <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file</span>
643:       <span class="ruby-keyword kw">end</span>
644: 
645:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rakefile_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_rakefile</span>
646:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">manifest_name</span>
647:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">uniq!</span>
648: 
649:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">manifest_name</span>, <span class="ruby-value str">'w'</span>).<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">files</span>)
650: 
651:       (<span class="ruby-identifier">files</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">old_files</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
652:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">gemspec_name</span>
653:         <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot; &quot;</span>
654:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">old_files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
655:           <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot;-&quot;</span>
656:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
657:           <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot;+&quot;</span>
658:         <span class="ruby-keyword kw">end</span>
659:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{sign} #{file}&quot;</span>
660:       <span class="ruby-keyword kw">end</span>
661:     <span class="ruby-keyword kw">end</span>
662: 
663:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:build_manifest</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:manifest</span>
664: 
665:     <span class="ruby-comment cmt">### Testing</span>
666: 
667:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test_pattern</span>.<span class="ruby-identifier">any?</span>
668: 
669:       <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">TestTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:test_inner</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
670:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">libs</span> = [<span class="ruby-value str">'lib'</span>, <span class="ruby-value str">'ext'</span>, <span class="ruby-value str">'bin'</span>, <span class="ruby-value str">'test'</span>]
671:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
672:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
673:       <span class="ruby-keyword kw">end</span>
674: 
675:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Run the test suite&quot;</span>
676:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:test</span> <span class="ruby-keyword kw">do</span>
677:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">'test/setup.rb'</span>
678:           <span class="ruby-constant">Echoe</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>
679:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Setting up test environment&quot;</span>
680:             <span class="ruby-identifier">system</span>(<span class="ruby-value str">&quot;ruby test/setup.rb&quot;</span>)
681:           <span class="ruby-keyword kw">end</span>
682:         <span class="ruby-keyword kw">end</span>
683:         <span class="ruby-keyword kw">begin</span>
684:           <span class="ruby-identifier">test</span> = <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-identifier">:test_inner</span>]
685:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:already_invoked=</span>
686:             <span class="ruby-comment cmt"># Method provided by MultiRails</span>
687:             <span class="ruby-identifier">test</span>.<span class="ruby-identifier">already_invoked</span> = <span class="ruby-keyword kw">false</span>
688:           <span class="ruby-keyword kw">end</span>
689:           <span class="ruby-identifier">test</span>.<span class="ruby-identifier">invoke</span>
690:         <span class="ruby-keyword kw">ensure</span>
691:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">'test/teardown.rb'</span>
692:             <span class="ruby-constant">Echoe</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>
693:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Tearing down test environment&quot;</span>
694:               <span class="ruby-identifier">system</span>(<span class="ruby-value str">&quot;ruby test/teardown.rb&quot;</span>)
695:             <span class="ruby-keyword kw">end</span>
696:           <span class="ruby-keyword kw">end</span>
697:         <span class="ruby-keyword kw">end</span>
698:       <span class="ruby-keyword kw">end</span>
699: 
700:     <span class="ruby-keyword kw">end</span>
701: 
702:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:test</span>
703: 
704:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">Rcov</span>
705:       <span class="ruby-constant">Rcov</span><span class="ruby-operator">::</span><span class="ruby-constant">RcovTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:coverage</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
706:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
707:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">rcov_opts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rcov_options</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rcov_options</span>
708:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
709:       <span class="ruby-keyword kw">end</span>
710:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:rcov</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:coverage</span>
711:     <span class="ruby-keyword kw">end</span>
712: 
713:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000177" class="method-detail">
        <a name="M000177"></a>

        <div class="method-heading">
          <a href="#M000177" class="method-signature">
          <span class="method-name">define_tasks</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000177-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000177-source">
<pre>
     <span class="ruby-comment cmt"># File lib/echoe.rb, line 310</span>
310:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">define_tasks</span>
311: 
312:     <span class="ruby-comment cmt">### Packaging and Installing</span>
313: 
314:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">spec</span> = <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span>.<span class="ruby-identifier">new</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
315:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">name</span>
316:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">version</span> = <span class="ruby-identifier">version</span>
317:       <span class="ruby-comment cmt"># s.specification_version = 3</span>
318:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">summary</span> = <span class="ruby-identifier">summary</span>
319:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">author</span> = <span class="ruby-constant">Array</span>(<span class="ruby-identifier">author</span>).<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;, &quot;</span>)
320:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">email</span>
321:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">homepage</span> = <span class="ruby-identifier">url</span>
322:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">rubyforge_project</span> = <span class="ruby-identifier">project</span>
323:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">post_install_message</span> = <span class="ruby-identifier">install_message</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">install_message</span>
324:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">description</span> = <span class="ruby-identifier">description</span>
325:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">required_ruby_version</span> = <span class="ruby-identifier">ruby_version</span>
326:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">required_rubygems_version</span> = <span class="ruby-identifier">rubygems_version</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rubygems_version</span>
327:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">platform</span> = <span class="ruby-identifier">platform</span>
328:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">rdoc_options</span> = <span class="ruby-identifier">rdoc_options</span>
329:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">extra_rdoc_files</span> = <span class="ruby-identifier">rdoc_pattern</span>
330: 
331:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">private_key</span>
332:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">signing_key</span> = <span class="ruby-identifier">private_key</span>
333:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">cert_chain</span> = <span class="ruby-identifier">certificate_chain</span>
334:       <span class="ruby-keyword kw">end</span>
335: 
336:       <span class="ruby-identifier">runtime_dependencies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dep</span><span class="ruby-operator">|</span>
337:         <span class="ruby-identifier">dep</span> = <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
338:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_runtime_dependency</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">dep</span>)
339:       <span class="ruby-keyword kw">end</span>
340: 
341:       <span class="ruby-identifier">development_dependencies</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">dep</span><span class="ruby-operator">|</span>
342:         <span class="ruby-identifier">dep</span> = <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot; &quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">dep</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">String</span>
343:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">add_development_dependency</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">dep</span>)
344:       <span class="ruby-keyword kw">end</span>
345: 
346:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">files</span> = <span class="ruby-identifier">files</span>
347: 
348:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">bindir</span> = <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">executable_pattern</span>.<span class="ruby-identifier">any?</span>
349:         <span class="ruby-identifier">executable_pattern</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;/&quot;</span>)[<span class="ruby-value">0</span>]
350:       <span class="ruby-keyword kw">else</span>
351:         <span class="ruby-value str">&quot;bin&quot;</span>
352:       <span class="ruby-keyword kw">end</span>
353: 
354:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">executables</span> = <span class="ruby-identifier">executable_pattern</span>.<span class="ruby-identifier">map</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
355:         <span class="ruby-identifier">file</span>[(<span class="ruby-identifier">s</span>.<span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>)<span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
356:       <span class="ruby-keyword kw">end</span>
357: 
358:       <span class="ruby-identifier">dirs</span> = <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'{lib,ext}'</span>]
359:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">extensions</span> = <span class="ruby-identifier">extension_pattern</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">any?</span>
360:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">require_paths</span> = <span class="ruby-identifier">dirs</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">dirs</span>.<span class="ruby-identifier">empty?</span>
361:       <span class="ruby-identifier">s</span>.<span class="ruby-identifier">has_rdoc</span> = <span class="ruby-identifier">has_rdoc</span>
362: 
363:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">&quot;test/test_all.rb&quot;</span>
364:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">test_file</span> = <span class="ruby-value str">&quot;test/test_all.rb&quot;</span>
365:       <span class="ruby-keyword kw">else</span>
366:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
367:       <span class="ruby-keyword kw">end</span>
368: 
369:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">eval</span>
370:         <span class="ruby-identifier">s</span>.<span class="ruby-identifier">instance_eval</span> <span class="ruby-operator">&amp;</span><span class="ruby-identifier">eval</span>
371:       <span class="ruby-keyword kw">end</span>
372: 
373:     <span class="ruby-keyword kw">end</span>
374: 
375:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">lib_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^lib/</span>)
376:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">bin_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^bin/</span>)
377:     <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">files</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/^test/</span>)
378: 
379:     <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">GemPackageTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">spec</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">pkg</span><span class="ruby-operator">|</span>
380:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_tar</span> = <span class="ruby-ivar">@need_tgz</span>
381:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_tar_gz</span> = <span class="ruby-ivar">@need_tar_gz</span>
382:       <span class="ruby-identifier">pkg</span>.<span class="ruby-identifier">need_zip</span> = <span class="ruby-ivar">@need_zip</span>
383:     <span class="ruby-keyword kw">end</span>
384:     
385:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Display Echoe's knowledge of your system&quot;</span>
386:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:details</span> <span class="ruby-keyword kw">do</span>
387:       (<span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">instance_variables</span>.<span class="ruby-identifier">sort</span> <span class="ruby-operator">-</span> [<span class="ruby-value str">'@spec'</span>]).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">var</span><span class="ruby-operator">|</span>
388:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{var}: #{instance_variable_get(var).inspect}&quot;</span>
389:       <span class="ruby-keyword kw">end</span>
390:     <span class="ruby-keyword kw">end</span>
391: 
392:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:build_gemspec</span> <span class="ruby-keyword kw">do</span>
393:       <span class="ruby-comment cmt"># Construct the gemspec file, if needed.</span>
394:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span>
395:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">gemspec_name</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>          
396:           <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">gemspec_format</span>
397:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:yaml</span>
398:             <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_yaml</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
399:               <span class="ruby-comment cmt"># Don't publish any information about the private key or certificate chain</span>
400:               <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">line</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/signing_key|cert_chain|\.pem/</span>
401:             <span class="ruby-keyword kw">end</span>          
402:           <span class="ruby-keyword kw">when</span> <span class="ruby-identifier">:ruby</span>
403:             <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">spec</span>.<span class="ruby-identifier">to_ruby</span>
404:           <span class="ruby-keyword kw">else</span>
405:             <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Unknown gemspec format #{gemspec_format.inspect}. Supported formats: :ruby and :yaml&quot;</span>
406:           <span class="ruby-keyword kw">end</span>
407:         <span class="ruby-keyword kw">end</span>
408:       <span class="ruby-keyword kw">end</span>
409:     <span class="ruby-keyword kw">end</span>
410: 
411:     <span class="ruby-comment cmt"># Chain it to the gemspec task prerequisite</span>
412:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">gemspec_name</span>.<span class="ruby-identifier">to_sym</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:build_gemspec</span>]
413: 
414:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:package</span> <span class="ruby-keyword kw">do</span>
415:       <span class="ruby-comment cmt"># Chain some cleanup tasks to the default :package task.</span>
416:       <span class="ruby-comment cmt"># Remove the gemfile if it wasn't actually requested.</span>
417:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@need_gem</span>
418:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;  Gem file not requested. Removed.&quot;</span>
419:         <span class="ruby-identifier">system</span> <span class="ruby-value str">&quot;rm pkg/*.gem&quot;</span>
420:       <span class="ruby-keyword kw">end</span>
421:       <span class="ruby-comment cmt"># Remove the generated gemspec once the packaging is done, to discourage people from modifying it by hand.</span>
422:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_gemspec</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">gemspec_name</span> <span class="ruby-keyword kw">and</span> <span class="ruby-keyword kw">not</span> <span class="ruby-identifier">retain_gemspec</span>
423:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">gemspec_name</span>
424:       <span class="ruby-keyword kw">end</span>
425: 
426:       <span class="ruby-comment cmt"># Test signing status</span>
427:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">private_key</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-identifier">private_key</span>
428:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Signing gem.&quot;</span>
429:       <span class="ruby-keyword kw">else</span>
430:         <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Key required, but not found. Maybe you forget to set ENV['GEM_PRIVATE_KEY']?&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">require_signed</span>
431:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Private key not found; gem will not be signed.&quot;</span>
432:       <span class="ruby-keyword kw">end</span>
433:       <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Targeting \&quot;#{platform}\&quot; platform.&quot;</span>
434:     <span class="ruby-keyword kw">end</span>
435: 
436:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Install the gem'</span>
437:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:install</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>, <span class="ruby-identifier">:uninstall</span>] <span class="ruby-keyword kw">do</span>
438:       <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} install pkg/*.gem -P MediumSecurity --no-update-sources&quot;</span>
439:     <span class="ruby-keyword kw">end</span>
440: 
441:     <span class="ruby-identifier">namespace</span> <span class="ruby-identifier">:install</span> <span class="ruby-keyword kw">do</span>
442:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Install the gem including development dependencies'</span>
443:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:development</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>, <span class="ruby-identifier">:uninstall</span>] <span class="ruby-keyword kw">do</span>
444:         <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} install pkg/*.gem -P MediumSecurity --no-update-sources --development&quot;</span>
445:       <span class="ruby-keyword kw">end</span>
446:     <span class="ruby-keyword kw">end</span>
447: 
448:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Uninstall the gem'</span>
449:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:uninstall</span> <span class="ruby-keyword kw">do</span>
450:       <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;#{'sudo' if use_sudo} #{gem_bin} uninstall #{name} -a -I -x&quot;</span>
451:     <span class="ruby-keyword kw">end</span>
452: 
453:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Package and upload the release to Rubyforge'</span>
454:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:release</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:package</span>] <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
455: 
456:       <span class="ruby-identifier">say</span> <span class="ruby-value str">&quot;\n&quot;</span>
457:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agree</span> <span class="ruby-node">&quot;Release #{name}-#{version} to Rubyforge? &quot;</span>
458:         <span class="ruby-identifier">pkg</span> = <span class="ruby-node">&quot;pkg/#{name}-#{version}&quot;</span>
459:         <span class="ruby-identifier">pkg_gem</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.gem&quot;</span>
460:         <span class="ruby-identifier">pkg_tar</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tgz&quot;</span>
461:         <span class="ruby-identifier">pkg_tar_gz</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.tar.gz&quot;</span>
462:         <span class="ruby-identifier">pkg_zip</span> = <span class="ruby-identifier">pkg</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;.zip&quot;</span>
463: 
464:         <span class="ruby-identifier">rf</span> = <span class="ruby-constant">RubyForge</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">configure</span>
465:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Logging in&quot;</span>
466:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">login</span>
467: 
468:         <span class="ruby-identifier">c</span> = <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">userconfig</span>
469:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;release_notes&quot;</span>] = <span class="ruby-identifier">description</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">description</span>
470:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;release_changes&quot;</span>] = <span class="ruby-identifier">changes</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">changes</span>
471:         <span class="ruby-identifier">c</span>[<span class="ruby-value str">&quot;preformatted&quot;</span>] = <span class="ruby-keyword kw">false</span>
472: 
473:         <span class="ruby-identifier">files</span> = [(<span class="ruby-ivar">@need_tgz</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_tar</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
474:                   (<span class="ruby-ivar">@need_tar_gz</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_tar_gz</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
475:                   (<span class="ruby-ivar">@need_zip</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_zip</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>),
476:                   (<span class="ruby-ivar">@need_gem</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">pkg_gem</span> <span class="ruby-operator">:</span> <span class="ruby-keyword kw">nil</span>)].<span class="ruby-identifier">compact</span>
477: 
478:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Releasing #{name} v. #{version}&quot;</span>
479:         <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span> = <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">version</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">ljust</span>(<span class="ruby-value">3</span>)
480: 
481:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">add_release</span> <span class="ruby-identifier">project</span>, <span class="ruby-identifier">name</span>, <span class="ruby-identifier">version</span>, <span class="ruby-operator">*</span><span class="ruby-identifier">files</span>
482:       <span class="ruby-keyword kw">end</span>
483: 
484:     <span class="ruby-keyword kw">end</span>
485: 
486:     <span class="ruby-comment cmt">### Extension building</span>
487: 
488:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:lib</span> <span class="ruby-keyword kw">do</span>
489:       <span class="ruby-identifier">directory</span> <span class="ruby-value str">&quot;lib&quot;</span>
490:     <span class="ruby-keyword kw">end</span>
491: 
492:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">any?</span>
493: 
494:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Compile the binary extension module&quot;</span>
495:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:compile</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:lib</span>] <span class="ruby-keyword kw">do</span>
496:         <span class="ruby-identifier">extension_pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">extension</span><span class="ruby-operator">|</span>
497:           <span class="ruby-identifier">ext_dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">extension</span>)
498:           <span class="ruby-identifier">lib_target</span> = <span class="ruby-keyword kw">nil</span>
499:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">chdir</span>(<span class="ruby-identifier">ext_dir</span>) <span class="ruby-keyword kw">do</span>
500:             <span class="ruby-identifier">ruby</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-identifier">extension</span>)
501:             <span class="ruby-identifier">system</span>(<span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/win32/</span> <span class="ruby-operator">?</span> <span class="ruby-value str">'nmake'</span> <span class="ruby-operator">:</span> <span class="ruby-value str">'make'</span>)
502:             <span class="ruby-identifier">lib_target</span> = <span class="ruby-identifier">open</span>(<span class="ruby-value str">'Makefile'</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">grep</span>(<span class="ruby-regexp re">/target_prefix = /</span>).<span class="ruby-identifier">first</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">'='</span>).<span class="ruby-identifier">last</span>.<span class="ruby-identifier">chomp</span>(<span class="ruby-value str">&quot;\n&quot;</span>).<span class="ruby-identifier">strip</span>
503:           <span class="ruby-keyword kw">end</span>
504:           <span class="ruby-constant">Dir</span>[<span class="ruby-node">&quot;#{ext_dir}/*.#{Config::CONFIG['DLEXT']}&quot;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
505:             <span class="ruby-identifier">dir</span> = <span class="ruby-node">&quot;lib/#{lib_target}/&quot;</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">'//'</span>, <span class="ruby-value str">'/'</span>)
506:             <span class="ruby-identifier">mkdir_p</span> <span class="ruby-identifier">dir</span>
507:             <span class="ruby-identifier">cp</span> <span class="ruby-identifier">file</span>, <span class="ruby-identifier">dir</span>
508:           <span class="ruby-keyword kw">end</span>
509:         <span class="ruby-keyword kw">end</span>
510:       <span class="ruby-keyword kw">end</span>
511: 
512:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:test</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:compile</span>]
513: 
514:     <span class="ruby-keyword kw">end</span>
515: 
516:     <span class="ruby-comment cmt">### Cross-platform targets</span>
517: 
518:     <span class="ruby-constant">Gem</span><span class="ruby-operator">::</span><span class="ruby-constant">Specification</span><span class="ruby-operator">::</span><span class="ruby-constant">PLATFORM_CROSS_TARGETS</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">target</span><span class="ruby-operator">|</span>
519:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">target</span> <span class="ruby-keyword kw">do</span>
520:         <span class="ruby-identifier">reset_target</span> <span class="ruby-identifier">target</span>
521:       <span class="ruby-keyword kw">end</span>
522:     <span class="ruby-keyword kw">end</span>
523: 
524:     <span class="ruby-comment cmt">### Documentation</span>
525: 
526:     <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">RDocTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:docs</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">rd</span><span class="ruby-operator">|</span>
527:       <span class="ruby-comment cmt"># rd.main = Dir['*'].detect {|f| f =~ /^readme/i}</span>
528:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">options</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Array</span>(<span class="ruby-identifier">rdoc_options</span>)
529: 
530:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">rdoc_dir</span> = <span class="ruby-value str">'doc'</span>
531:       <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">rdoc_files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-operator">*</span><span class="ruby-identifier">rdoc_pattern</span>)
532: 
533:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rdoc_template</span>
534:         <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">template</span> = <span class="ruby-identifier">rdoc_template</span>
535:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RDOC_TEMPLATE'</span>]
536:         <span class="ruby-identifier">rd</span>.<span class="ruby-identifier">template</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'RDOC_TEMPLATE'</span>]
537:       <span class="ruby-keyword kw">end</span>
538:     <span class="ruby-keyword kw">end</span>
539: 
540:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:doc</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:redocs</span>]
541: 
542:     <span class="ruby-identifier">desc</span> <span class="ruby-node">&quot;Publish documentation to #{docs_host ? &quot;'#{docs_host}'&quot; : &quot;rubyforge&quot;}&quot;</span>
543:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:publish_docs</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>, <span class="ruby-identifier">:docs</span>] <span class="ruby-keyword kw">do</span>
544: 
545:       <span class="ruby-identifier">local_dir</span> = <span class="ruby-value str">'doc'</span>
546:       <span class="ruby-identifier">remote_dir_name</span> = <span class="ruby-identifier">project</span>
547:       <span class="ruby-identifier">remote_dir_name</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;/#{name}&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">name</span>
548: 
549:       <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">docs_host</span>
550:         <span class="ruby-identifier">config</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-value str">&quot;~/.rubyforge/user-config.yml&quot;</span>)))
551:         <span class="ruby-identifier">pub</span> = <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">SshDirPublisher</span>.<span class="ruby-identifier">new</span> <span class="ruby-node">&quot;#{config[&quot;username&quot;]}@rubyforge.org&quot;</span>,
552:           <span class="ruby-node">&quot;/var/www/gforge-projects/#{remote_dir_name}&quot;</span>,
553:           <span class="ruby-identifier">local_dir</span>
554:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">project</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">name</span> <span class="ruby-keyword kw">then</span>
555:           <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">pub</span>.<span class="ruby-identifier">upload</span>
556:             <span class="ruby-keyword kw">begin</span>
557:               <span class="ruby-keyword kw">super</span>
558:             <span class="ruby-keyword kw">rescue</span>
559:               <span class="ruby-comment cmt"># project directory probably doesn't exist, transfer as a whole</span>
560:               <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -qr #{local_dir} #{host}:#{remote_dir}&quot;</span>
561:               <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Uploading: #{cmd}&quot;</span>
562:               <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
563:             <span class="ruby-keyword kw">end</span>
564:           <span class="ruby-keyword kw">end</span>
565:         <span class="ruby-keyword kw">end</span>
566:         <span class="ruby-identifier">pub</span>.<span class="ruby-identifier">upload</span>
567:       <span class="ruby-keyword kw">else</span>
568:         <span class="ruby-comment cmt"># you may need ssh keys configured for this to work</span>
569:         <span class="ruby-identifier">host</span>, <span class="ruby-identifier">dir</span> = <span class="ruby-identifier">docs_host</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;:&quot;</span>)
570:         <span class="ruby-identifier">dir</span>.<span class="ruby-identifier">chomp!</span>(<span class="ruby-value str">&quot;/&quot;</span>)
571: 
572:         <span class="ruby-comment cmt"># XXX too dangerous?</span>
573:         <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;ssh #{host} 'rm -rf #{dir}/#{remote_dir_name}'&quot;</span>
574:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Deleting existing docs: #{cmd}&quot;</span>
575:         <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
576: 
577:         <span class="ruby-identifier">cmd</span> = <span class="ruby-node">&quot;scp -qr #{local_dir} #{host}:#{dir}/#{remote_dir_name}&quot;</span>
578:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;Uploading: #{cmd}&quot;</span>
579:         <span class="ruby-identifier">system</span>(<span class="ruby-identifier">cmd</span>)
580:       <span class="ruby-keyword kw">end</span>
581:     <span class="ruby-keyword kw">end</span>
582: 
583:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Generate a release announcement, edit it, and post it to Rubyforge.'</span>
584:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:announce</span> <span class="ruby-keyword kw">do</span>
585: 
586:       <span class="ruby-identifier">filename</span> = <span class="ruby-node">&quot;/tmp/#{name}_#{version}_announcement.txt&quot;</span>
587: 
588:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Overwrite existing announcement file? &quot;</span>
589:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-value str">'w'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
590:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;Subject: #{name.capitalize} #{version}\n\n&quot;</span>
591:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;#{name.capitalize} has been updated to #{version}. #{name.capitalize} is #{summary.uncapitalize}\n\n&quot;</span>
592:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;Changes in this version: #{changes.sub(/^\s*[\w\d\.]+\s+/, '').uncapitalize}\n\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">changes</span>.<span class="ruby-identifier">empty?</span>
593:           <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span> <span class="ruby-node">&quot;More information is available at #{url} .\n\n&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">url</span>.<span class="ruby-identifier">empty?</span>
594:         <span class="ruby-keyword kw">end</span>
595:       <span class="ruby-keyword kw">end</span>
596: 
597:       <span class="ruby-keyword kw">begin</span>
598:         <span class="ruby-identifier">editor</span> = <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'EDITOR'</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">'nano'</span>
599:         <span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;#{editor} #{filename}&quot;</span>) <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-node">&quot;Editor '#{editor}' failed to start&quot;</span>
600:         <span class="ruby-identifier">puts</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">read</span>
601:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">while</span> <span class="ruby-operator">!</span><span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Done editing? &quot;</span>
602: 
603:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agree</span> <span class="ruby-value str">&quot;Publish announcement to Rubyforge? &quot;</span>
604:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">detect</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Subject: (.*)/</span> }
605:         <span class="ruby-identifier">subject</span> = <span class="ruby-identifier">$1</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">raise</span> <span class="ruby-value str">&quot;Subject line seems to have disappeared&quot;</span>
606: 
607:         <span class="ruby-identifier">body</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">readlines</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/Subject: /</span> }.<span class="ruby-identifier">join</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-value str">&quot;\n\n\n&quot;</span>, <span class="ruby-value str">&quot;\n\n&quot;</span>)
608: 
609:         <span class="ruby-identifier">rf</span> = <span class="ruby-constant">RubyForge</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">configure</span>
610:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">login</span>
611:         <span class="ruby-identifier">rf</span>.<span class="ruby-identifier">post_news</span>(<span class="ruby-identifier">project</span>, <span class="ruby-identifier">subject</span>, <span class="ruby-identifier">body</span>)
612:         <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Published.&quot;</span>
613:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span> <span class="ruby-identifier">filename</span>
614:       <span class="ruby-keyword kw">end</span>
615:     <span class="ruby-keyword kw">end</span>
616: 
617:     <span class="ruby-comment cmt">### Clean</span>
618: 
619:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">'Clean up auto-generated files'</span>
620:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:clean</span> <span class="ruby-keyword kw">do</span>
621:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Cleaning&quot;</span>
622:       <span class="ruby-identifier">clean_pattern</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
623:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
624:           <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;- #{file}&quot;</span>
625:           <span class="ruby-identifier">rm_rf</span> <span class="ruby-identifier">file</span>
626:         <span class="ruby-keyword kw">end</span>
627:       <span class="ruby-keyword kw">end</span>
628:     <span class="ruby-keyword kw">end</span>
629: 
630:     <span class="ruby-comment cmt">### Manifest</span>
631: 
632:     <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Build a Manifest list&quot;</span>
633:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:manifest</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-identifier">:clean</span>] <span class="ruby-keyword kw">do</span>
634:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Building Manifest&quot;</span>
635:       <span class="ruby-identifier">old_files</span> = <span class="ruby-identifier">files</span>
636:       <span class="ruby-identifier">files</span> = []
637:       <span class="ruby-constant">Dir</span>[<span class="ruby-value str">'**/**'</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
638:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">file</span>
639:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ignore_pattern</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
640:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">directory?</span>(<span class="ruby-identifier">file</span>)
641:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">include_rakefile</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">rakefile_name</span>
642:         <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">file</span>
643:       <span class="ruby-keyword kw">end</span>
644: 
645:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rakefile_name</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">include_rakefile</span>
646:       <span class="ruby-identifier">files</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">manifest_name</span>
647:       <span class="ruby-identifier">files</span>.<span class="ruby-identifier">uniq!</span>
648: 
649:       <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">manifest_name</span>, <span class="ruby-value str">'w'</span>).<span class="ruby-identifier">puts</span>(<span class="ruby-identifier">files</span>)
650: 
651:       (<span class="ruby-identifier">files</span> <span class="ruby-operator">|</span> <span class="ruby-identifier">old_files</span>).<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">file</span><span class="ruby-operator">|</span>
652:         <span class="ruby-keyword kw">next</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">gemspec_name</span>
653:         <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot; &quot;</span>
654:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">old_files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
655:           <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot;-&quot;</span>
656:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">old_files</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">file</span>)
657:           <span class="ruby-identifier">sign</span> = <span class="ruby-value str">&quot;+&quot;</span>
658:         <span class="ruby-keyword kw">end</span>
659:         <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{sign} #{file}&quot;</span>
660:       <span class="ruby-keyword kw">end</span>
661:     <span class="ruby-keyword kw">end</span>
662: 
663:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:build_manifest</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:manifest</span>
664: 
665:     <span class="ruby-comment cmt">### Testing</span>
666: 
667:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test_pattern</span>.<span class="ruby-identifier">any?</span>
668: 
669:       <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">TestTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:test_inner</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
670:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">libs</span> = [<span class="ruby-value str">'lib'</span>, <span class="ruby-value str">'ext'</span>, <span class="ruby-value str">'bin'</span>, <span class="ruby-value str">'test'</span>]
671:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
672:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
673:       <span class="ruby-keyword kw">end</span>
674: 
675:       <span class="ruby-identifier">desc</span> <span class="ruby-value str">&quot;Run the test suite&quot;</span>
676:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:test</span> <span class="ruby-keyword kw">do</span>
677:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">'test/setup.rb'</span>
678:           <span class="ruby-constant">Echoe</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>
679:             <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Setting up test environment&quot;</span>
680:             <span class="ruby-identifier">system</span>(<span class="ruby-value str">&quot;ruby test/setup.rb&quot;</span>)
681:           <span class="ruby-keyword kw">end</span>
682:         <span class="ruby-keyword kw">end</span>
683:         <span class="ruby-keyword kw">begin</span>
684:           <span class="ruby-identifier">test</span> = <span class="ruby-constant">Rake</span><span class="ruby-operator">::</span><span class="ruby-constant">Task</span>[<span class="ruby-identifier">:test_inner</span>]
685:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">test</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-identifier">:already_invoked=</span>
686:             <span class="ruby-comment cmt"># Method provided by MultiRails</span>
687:             <span class="ruby-identifier">test</span>.<span class="ruby-identifier">already_invoked</span> = <span class="ruby-keyword kw">false</span>
688:           <span class="ruby-keyword kw">end</span>
689:           <span class="ruby-identifier">test</span>.<span class="ruby-identifier">invoke</span>
690:         <span class="ruby-keyword kw">ensure</span>
691:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-value str">'test/teardown.rb'</span>
692:             <span class="ruby-constant">Echoe</span>.<span class="ruby-identifier">silence</span> <span class="ruby-keyword kw">do</span>
693:               <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;Tearing down test environment&quot;</span>
694:               <span class="ruby-identifier">system</span>(<span class="ruby-value str">&quot;ruby test/teardown.rb&quot;</span>)
695:             <span class="ruby-keyword kw">end</span>
696:           <span class="ruby-keyword kw">end</span>
697:         <span class="ruby-keyword kw">end</span>
698:       <span class="ruby-keyword kw">end</span>
699: 
700:     <span class="ruby-keyword kw">end</span>
701: 
702:     <span class="ruby-identifier">task</span> <span class="ruby-identifier">:default</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:test</span>
703: 
704:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">Rcov</span>
705:       <span class="ruby-constant">Rcov</span><span class="ruby-operator">::</span><span class="ruby-constant">RcovTask</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:coverage</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
706:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">test_files</span> = <span class="ruby-identifier">test_pattern</span>
707:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">rcov_opts</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">rcov_options</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rcov_options</span>
708:         <span class="ruby-identifier">t</span>.<span class="ruby-identifier">verbose</span> = <span class="ruby-keyword kw">true</span>
709:       <span class="ruby-keyword kw">end</span>
710:       <span class="ruby-identifier">task</span> <span class="ruby-identifier">:rcov</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:coverage</span>
711:     <span class="ruby-keyword kw">end</span>
712: 
713:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>